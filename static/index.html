<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo Dashboard - Modern Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .todo-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .todo-card:hover {
            transform: translateY(-2px);
        }
        
        .priority-high {
            border-left: 4px solid #ef4444;
        }
        
        .priority-medium {
            border-left: 4px solid #f59e0b;
        }
        
        .priority-low {
            border-left: 4px solid #10b981;
        }
        
        .status-completed {
            opacity: 0.7;
        }
        
        .status-completed .todo-title {
            text-decoration: line-through;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-tasks text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Todo Dashboard</h1>
                        <p class="text-purple-100 text-sm">Modern Task Management System</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-purple-100">Total Tasks</p>
                        <p class="text-2xl font-bold" id="totalCount">0</p>
                    </div>
                    <button onclick="openAddModal()" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-purple-50 transition-colors flex items-center space-x-2">
                        <i class="fas fa-plus"></i>
                        <span>Add Task</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Pending</p>
                        <p class="text-2xl font-bold text-gray-800" id="pendingCount">0</p>
                    </div>
                    <div class="bg-yellow-100 p-3 rounded-lg">
                        <i class="fas fa-clock text-yellow-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">In Progress</p>
                        <p class="text-2xl font-bold text-blue-600" id="progressCount">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-spinner text-blue-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Completed</p>
                        <p class="text-2xl font-bold text-green-600" id="completedCount">0</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i class="fas fa-check-circle text-green-600"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">High Priority</p>
                        <p class="text-2xl font-bold text-red-600" id="highPriorityCount">0</p>
                    </div>
                    <div class="bg-red-100 p-3 rounded-lg">
                        <i class="fas fa-exclamation-triangle text-red-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters and Search -->
        <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-gray-100">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Search tasks..." 
                               class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <select id="statusFilter" class="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                </select>
                
                <select id="priorityFilter" class="px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="">All Priority</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                
                <button onclick="clearFilters()" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                    <i class="fas fa-times mr-2"></i>Clear
                </button>
            </div>
        </div>

        <!-- Todo List -->
        <div id="todoList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Todos will be dynamically added here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-12 hidden">
            <i class="fas fa-clipboard-list text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">No tasks found</h3>
            <p class="text-gray-400 mb-6">Start by adding your first task!</p>
            <button onclick="openAddModal()" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                <i class="fas fa-plus mr-2"></i>Add Your First Task
            </button>
        </div>
    </main>

    <!-- Add/Edit Modal -->
    <div id="todoModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 glass-effect">
                <h2 class="text-2xl font-bold mb-6 text-gray-800" id="modalTitle">Add New Task</h2>
                
                <form id="todoForm">
                    <input type="hidden" id="todoId">
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Title *</label>
                        <input type="text" id="todoTitle" required
                               class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="Enter task title...">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Description</label>
                        <textarea id="todoDescription" rows="3"
                                  class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                                  placeholder="Enter task description..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2">Priority</label>
                            <select id="todoPriority" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2">Status</label>
                            <select id="todoStatus" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="pending" selected>Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button type="submit" class="flex-1 bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Task
                        </button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 glass-effect">
                <div class="text-center mb-6">
                    <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-trash text-red-600 text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Delete Task</h2>
                    <p class="text-gray-600">Are you sure you want to delete this task? This action cannot be undone.</p>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="confirmDelete()" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash mr-2"></i>Delete Task
                    </button>
                    <button onclick="closeDeleteModal()" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50 fade-in">
        <div class="flex items-center space-x-2">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">Success!</span>
        </div>
    </div>

    <script>
        // Todo Dashboard JavaScript
        let todos = [];
        let currentEditId = null;
        let deleteTodoId = null;

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadTodos();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Form submission
            const todoForm = document.getElementById('todoForm');
            if (todoForm) {
                todoForm.addEventListener('submit', handleFormSubmit);
            }
            
            // Search and filters
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', filterTodos);
            }
            
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', filterTodos);
            }
            
            const priorityFilter = document.getElementById('priorityFilter');
            if (priorityFilter) {
                priorityFilter.addEventListener('change', filterTodos);
            }
            
            // Close modal on backdrop click
            const todoModal = document.getElementById('todoModal');
            if (todoModal) {
                todoModal.addEventListener('click', function(e) {
                    if (e.target.id === 'todoModal') {
                        closeModal();
                    }
                });
            }
            
            // Close delete modal on backdrop click
            const deleteModal = document.getElementById('deleteModal');
            if (deleteModal) {
                deleteModal.addEventListener('click', function(e) {
                    if (e.target.id === 'deleteModal') {
                        closeDeleteModal();
                    }
                });
            }
        }

        // Load all todos from API
        async function loadTodos() {
            try {
                showLoading();
                const response = await fetch('/todos');
                const data = await response.json();
                
                if (data.data) {
                    todos = data.data;
                } else {
                    todos = [];
                }
                
                renderTodos();
                updateStats();
                hideLoading();
            } catch (error) {
                console.error('Error loading todos:', error);
                showToast('Error loading tasks', 'error');
                hideLoading();
            }
        }

        // Render todos to the DOM
        function renderTodos() {
            const todoList = document.getElementById('todoList');
            const emptyState = document.getElementById('emptyState');
            
            const filteredTodos = getFilteredTodos();
            
            if (filteredTodos.length === 0) {
                todoList.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            todoList.innerHTML = filteredTodos.map(todo => `
                <div class="todo-card bg-white rounded-xl shadow-sm p-6 border border-gray-100 priority-${todo.priority} ${todo.status === 'completed' ? 'status-completed' : ''} fade-in">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="todo-title text-lg font-semibold text-gray-800">${escapeHtml(todo.title)}</h3>
                        <div class="flex space-x-2">
                            <button onclick="editTodo('${todo.id}')" class="text-blue-500 hover:text-blue-700 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTodo('${todo.id}')" class="text-red-500 hover:text-red-700 transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${todo.description ? `<p class="text-gray-600 mb-4 text-sm">${escapeHtml(todo.description)}</p>` : ''}
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="priority-badge px-2 py-1 rounded-full text-xs font-semibold ${getPriorityClass(todo.priority)}">
                                ${todo.priority}
                            </span>
                            <span class="status-badge px-2 py-1 rounded-full text-xs font-semibold ${getStatusClass(todo.status)}">
                                ${formatStatus(todo.status)}
                            </span>
                        </div>
                        <div class="text-xs text-gray-400">
                            ${formatDate(todo.created_at)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get filtered todos based on search and filters
        function getFilteredTodos() {
            let filtered = [...todos];
            
            // Search filter
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(todo => 
                    todo.title.toLowerCase().includes(searchTerm) ||
                    (todo.description && todo.description.toLowerCase().includes(searchTerm))
                );
            }
            
            // Status filter
            const statusFilter = document.getElementById('statusFilter').value;
            if (statusFilter) {
                filtered = filtered.filter(todo => todo.status === statusFilter);
            }
            
            // Priority filter
            const priorityFilter = document.getElementById('priorityFilter').value;
            if (priorityFilter) {
                filtered = filtered.filter(todo => todo.priority === priorityFilter);
            }
            
            return filtered;
        }

        // Filter todos
        function filterTodos() {
            renderTodos();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            renderTodos();
        }

        // Open add modal
        function openAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Task';
            document.getElementById('todoForm').reset();
            document.getElementById('todoModal').classList.remove('hidden');
        }

        // Edit todo
        async function editTodo(id) {
            try {
                const todo = todos.find(t => t.id === id);
                
                if (!todo) {
                    showToast('Task not found', 'error');
                    return;
                }
                
                currentEditId = id;
                document.getElementById('modalTitle').textContent = 'Edit Task';
                document.getElementById('todoId').value = id;
                document.getElementById('todoTitle').value = todo.title;
                document.getElementById('todoDescription').value = todo.description || '';
                document.getElementById('todoPriority').value = todo.priority;
                document.getElementById('todoStatus').value = todo.status;
                
                document.getElementById('todoModal').classList.remove('hidden');
            } catch (error) {
                console.error('Error editing todo:', error);
                showToast('Error loading task for editing', 'error');
            }
        }

        // Delete todo
        async function deleteTodo(id) {
            deleteTodoId = id; // Store the ID to delete
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        // Confirm delete
        async function confirmDelete() {
            if (!deleteTodoId) return;
            
            try {
                const response = await fetch(`/todos/${deleteTodoId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    todos = todos.filter(t => t.id !== deleteTodoId);
                    renderTodos();
                    updateStats();
                    showToast('Task deleted successfully');
                } else {
                    const error = await response.json();
                    showToast(error.detail || 'Error deleting task', 'error');
                }
            } catch (error) {
                console.error('Error deleting todo:', error);
                showToast('Error deleting task', 'error');
            } finally {
                closeDeleteModal();
            }
        }

        // Close delete modal
        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            deleteTodoId = null;
        }

        // Handle form submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('todoTitle').value.trim();
            const description = document.getElementById('todoDescription').value.trim();
            const priority = document.getElementById('todoPriority').value;
            const status = document.getElementById('todoStatus').value;
            
            if (!title) {
                showToast('Title is required', 'error');
                return;
            }
            
            const todoData = {
                title,
                description,
                priority,
                status
            };
            
            try {
                let response;
                
                if (currentEditId) {
                    // Update existing todo
                    response = await fetch(`/todos/${currentEditId}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(todoData)
                    });
                } else {
                    // Create new todo
                    response = await fetch('/todos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(todoData)
                    });
                }
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (currentEditId) {
                        // Update existing todo in the array
                        const index = todos.findIndex(t => t.id === currentEditId);
                        if (index !== -1) {
                            todos[index] = result.data;
                        }
                        showToast('Task updated successfully');
                    } else {
                        // Add new todo to the array
                        todos.push(result.data);
                        showToast('Task created successfully');
                    }
                    
                    closeModal();
                    renderTodos();
                    updateStats();
                } else {
                    const error = await response.json();
                    showToast(error.detail || 'Error saving task', 'error');
                }
            } catch (error) {
                console.error('Error saving todo:', error);
                showToast('Error saving task', 'error');
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('todoModal').classList.add('hidden');
            document.getElementById('todoForm').reset();
            currentEditId = null;
        }

        // Update statistics
        function updateStats() {
            const totalCount = todos.length;
            const pendingCount = todos.filter(t => t.status === 'pending').length;
            const progressCount = todos.filter(t => t.status === 'in_progress').length;
            const completedCount = todos.filter(t => t.status === 'completed').length;
            const highPriorityCount = todos.filter(t => t.priority === 'high' && t.status !== 'completed').length;
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('progressCount').textContent = progressCount;
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('highPriorityCount').textContent = highPriorityCount;
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function formatStatus(status) {
            return status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function getPriorityClass(priority) {
            const classes = {
                high: 'bg-red-100 text-red-700',
                medium: 'bg-yellow-100 text-yellow-700',
                low: 'bg-green-100 text-green-700'
            };
            return classes[priority] || classes.medium;
        }

        function getStatusClass(status) {
            const classes = {
                pending: 'bg-gray-100 text-gray-700',
                in_progress: 'bg-blue-100 text-blue-700',
                completed: 'bg-green-100 text-green-700'
            };
            return classes[status] || classes.pending;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            if (type === 'error') {
                toast.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            } else {
                toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            }
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function showLoading() {
            // Loading indicator if needed
        }

        function hideLoading() {
            // Hide loading indicator
        }
    </script>
</body>
</html>
